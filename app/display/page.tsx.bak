"use client";
import { useState } from "react";
import Link from "next/link";
import { PinLock } from "@/components/security/PinLock";
import { CookieBanner } from "@/components/CookieBanner";

export default function Display(){
  const [showLock,setShowLock]=useState(false);

  function setLangAndGo(code: string){
    try { localStorage.setItem("targetLang", code.toUpperCase()); } catch {}
    location.href = "/display/live";
  }

  return (
    <main className="welcome-container">
      <button
        className="settings-button"
        data-testid="btn-settings"
        aria-label="settings"
        onClick={()=>setShowLock(true)}
      >âš™ï¸</button>

      <h1 className="welcome-title" data-testid="welcome-language-prompt">
        Please select your language
      </h1>

      <div className="language-cards">
        <div
          className="language-card english"
          tabIndex={0}
          data-testid="lang-en"
          onClick={()=>setLangAndGo("EN")}
          onKeyDown={(e)=>{ if(e.key==="Enter") setLangAndGo("EN"); }}
        >
          <h2>English</h2>
          <p>If you have any questions,<br/>I'm here to help.</p>
          <span className="tap-hint">ğŸ‘‰ Tap here</span>
        </div>

        <div
          className="language-card korean"
          tabIndex={0}
          data-testid="lang-ko"
          onClick={()=>setLangAndGo("KO")}
          onKeyDown={(e)=>{ if(e.key==="Enter") setLangAndGo("KO"); }}
        >
          <h2>í•œêµ­ì–´</h2>
          <p>ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´<br/>ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>
          <span className="tap-hint">ğŸ‘‰ ì„ íƒ</span>
        </div>

        <div
          className="language-card chinese"
          tabIndex={0}
          data-testid="lang-zh"
          onClick={()=>setLangAndGo("ZH")}
          onKeyDown={(e)=>{ if(e.key==="Enter") setLangAndGo("ZH"); }}
        >
          <h2>ä¸­æ–‡</h2>
          <p>å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œ<br/>æˆ‘ä¼šä¸ºæ‚¨æä¾›å¸®åŠ©ã€‚</p>
          <span className="tap-hint">ğŸ‘‰ ç‚¹å‡»</span>
        </div>
      </div>

      <div className="footer-logo" data-testid="welcome-logo-footer">
        ã‚ã‚“ã—ã‚“ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤
      </div>

      <section className="text-center mt-10">
        <Link href="/admin/subscription" className="inline-block bg-[#F59E0B] text-white px-6 py-3 rounded-2xl">
          ãƒã‚¤ã‚¯åˆ°ç€å¾Œ14æ—¥ ç„¡æ–™ã§ãŠè©¦ã—
        </Link>
      </section>

      <section className="text-center mt-4">
        <a className="underline text-sm" href="/display/live">ãƒ‡ãƒ¢ã‚’è¦‹ã‚‹ï¼ˆãƒã‚¤ã‚¯è¦è¨±å¯ï¼‰</a>
      </section>

      <CookieBanner />
      {showLock && <PinLock><div /></PinLock>}
    </main>
  );
}